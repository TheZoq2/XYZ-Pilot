NOP

NULL = 0000000000000000
MANYF = FFFFFFFFFFFFFFFF

ARRAYSTART = 0000000000000100
ARRAYEND = 0000000000000100
ARRAYSIZE = 0 

SHIPPOS = 0090009000000000
SHIPVEL = 0000000000000000
SHIPACC = 0000000000000000
VECADDRIGHT = 0001000000000000
VECADDDOWN = 0000000100000000 
MAXSPEED = 3
VECROTRIGHT = 000000000000000


SHIPROT = 0000000000000000

SHIP_ANGLE = 0000000000000000
TURN_SPEED = 0000000000050000

SLOW_TURN_ADD = 0002000000020000
SLOW_TURN = 0000000000000000

SHIP_SPIN = 0000000000000000
SHIP_SPIN_ADD = 0004000400000000
IS_SPINNING = 1

COUNTER = 0
COUNTMAX = 2


#Modify the model memory
ASTEROID_START = 7A
LOAD 0 ASTEROID_START
STOREOBJ 0 7

ITER:
  LOAD 0 SHIPPOS
  LOAD 1 SHIPVEL
  LOAD 3 VECADDRIGHT
  LOAD 4 VECADDDOWN
  LOAD 6 VECROTRIGHT

  LOAD 7 SHIP_ANGLE
  LOAD 8 TURN_SPEED


  # STYR SKEPPETS HASTIGHET
  LOAD 9 COUNTER
  LOAD A COUNTMAX
  CMP 9 A
  BNE COUNTUP
  LOAD 9 NULL
  STORE 9 COUNTER

  TESTLEFT:
    BTST F 5
    BEQ GOLEFT
  TESTDOWN:
    BTST F 4
    BEQ GODOWN
  TESTUP:
    BTST F 6
    BEQ GOUP
  TESTRIGHT:
    BTST F 3
    BEQ GORIGHT
  
  TEST_TURN_LEFT:
    BTST F 0
    BEQ TURN_LEFT
  TEST_TURN_RIGHT:
    BTST F 1
    BEQ TURN_RIGHT
  TEST_SPIN: 
    BTST F 2
    BEQ DO_SPIN
  

  MOVED:


  #Update ship position and angle
  ADD 0 0 1
  STOREOBJ 0 0
  ADD 3 7 3
  STOREOBJ 3 1

  #Spin the asteroid
  LOAD 2 SLOW_TURN_ADD
  LOAD 5 SLOW_TURN

  VECADD 5 5 2
  #LSLI 5 5 1
  STOREOBJ 5 5

  STORE 0 SHIPPOS
  STORE 1 SHIPVEL
  STORE 7 SHIP_ANGLE

  STORE 5 SLOW_TURN
  #Update the angle of the ship

  #BRA COS_TEST
  BRA DOT_TEST
  COS_TEST_DONE:

  WAITFRAME
  WAITFRAME

  BRA ITER


COUNTUP:
  ADDI 9 9 1
  STORE 9 COUNTER
  BRA TEST_TURN_LEFT  

#Movement 'subroutines'
GORIGHT:
  LOAD 9 NULL
  LOAD A MAXSPEED
  ADD 9 9 A
  LSRI A 1 30
  CMP 9 A
  BEQ TEST_TURN_LEFT
  ADD 1 1 3
  BRA TEST_TURN_LEFT
GOLEFT:
  LOAD 9 NULL
  LOAD A MAXSPEED
  SUB 9 9 A
  LSRI A 1 30
  CMP 9 A
  BEQ TESTDOWN
  SUB 1 1 3
  BRA TESTDOWN
GODOWN:
  LOAD 9 NULL
  LOAD A MAXSPEED
  ADD 9 9 A
  LSRI A 1 20
  MOVLO B 0000FFFF
  AND A A B
  CMP 9 A
  BEQ TESTUP
  ADD 1 1 4
  BRA TESTUP
GOUP:
  LOAD 9 NULL
  LOAD A MAXSPEED
  SUB 9 9 A
  LSRI A 1 20
  MOVLO B 0000FFFF
  AND A A B
  CMP 9 A
  BEQ TESTUP
  SUB 1 1 4
  BRA TESTRIGHT
TURN_LEFT:
  ADD 7 7 8
  BRA TEST_TURN_RIGHT
TURN_RIGHT:
  SUB 7 7 8
  BRA DO_SPIN

DO_SPIN:
  IS_SPINNING = 1
  BRA MOVED


COS_TEST:
  TEST_LEN = 20

  #Load the ship angle
  LOAD 0 SHIP_ANGLE
  LSRI 0 SHIP_ANGLE 10

  LOAD 1 TEST_LEN
  
  MULCOS 2 SHIP_ANGLE TEST_LEN

  LSLI 2 2 20

  STOREOBJ 2 4 
  #STOREOBJ SHIP_ANGLE 5

  BRA COS_TEST_DONE

DOT_TEST:
  TEST_VEC = 00010000000000000000
  LOAD 0 TEST_VEC
  LOAD 1 SHIPPOS

  #LOAD 1 
  DOT 2 TEST_VEC SHIPPOS
  
  LSRI 2 2 30
  STOREOBJ 2 4

  BRA COS_TEST_DONE
